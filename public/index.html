<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b74de">
  <title>Sistema de Gest√£o de Stock ‚Äî Dashboard</title>
  <style>
    :root {--accent: #0b74de;--accent-2: #08a08a;--bg: #f6f8fb;--card: #fff;--muted: #6b7280;}
    [data-theme="dark"] {--bg: #0b1220;--card: #071026;--accent: #42a5f5;--muted: #9aa6b2;color: #e6eef6;}
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {font-family: "Inter", Arial, sans-serif;background: var(--bg);color: #0f1724;min-height: 100vh;display: flex;flex-direction: column;}

    header {background: linear-gradient(90deg, var(--accent), var(--accent-2));
    color: #fff;padding: 14px 24px;display: flex;justify-content: space-between;align-items: center;box-shadow: 0 3px 8px rgba(0,0,0,.15);}
    .logo {display: flex;align-items: center;font-size: 1.2rem;font-weight: 700;}
    .logo span {background: #fff;color: var(--accent);border-radius: 6px;padding: 6px 10px;margin-right: 8px;font-weight: 800;}
    main {flex: 1;max-width: 960px;width: 100%;margin: 40px auto;padding: 0 18px;}
    /* Login box */
    .login-box {background: var(--card);padding: 32px;border-radius: 16px;box-shadow: 0 8px 24px rgba(0,0,0,.08);max-width: 360px;margin: auto;
      text-align: center;animation: fadeIn .4s ease-in-out;}
    .login-box h2 {margin-bottom: 20px;}
    .login-box input,
    .login-box button {width: 100%;margin-top: 10px;padding: 12px;border-radius: 8px;border: 1px solid var(--muted);font-size: 1rem;}
    .login-box button {background: var(--accent);color: #fff;border: none;font-weight: 600;cursor: pointer;transition: 0.3s;}
    .login-box button:hover {background: var(--accent-2);}
    /* Cards grid */
    .cards {display: grid;grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));gap: 20px;margin-top: 40px;animation: fadeIn .4s ease-in-out;}
    .card {background: var(--card);padding: 24px;border-radius: 14px;cursor: pointer;box-shadow: 0 4px 14px rgba(0,0,0,.05);transition: .2s;}
    .card:hover { transform: translateY(-6px); }
    .card h3 { margin-bottom: 8px; }
    .muted { color: var(--muted); }

    /* Fundo com gradiente e centraliza√ß√£o */
  
  body.login-active {
    background: linear-gradient(135deg, #0b74de 0%, #08a08a 100%);
    height: 100vh;margin: 0;display: flex;justify-content: center;align-items: center;}

  /* Container que agrupa emoji e caixa */
  #loginContainer {display: flex;flex-direction: column;align-items: center;}

  /* Emoji grande */
  .login-icon {font-size: 6rem;margin-bottom: 24px;text-shadow: 0 4px 12px rgba(0,0,0,0.2);}

  /* Caixa do formul√°rio */
  .login-box {background: rgba(255, 255, 255, 0.96);padding: 40px 36px;border-radius: 20px;box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
    max-width: 380px;width: 100%;text-align: center;backdrop-filter: blur(6px);animation: fadeIn .5s ease-in-out;}
  .login-box h2 {font-size: 1.8rem;font-weight: 700;color: #0b74de;margin-bottom: 28px;}
  .login-box input {width: 100%;margin-top: 14px;padding: 14px 16px;border-radius: 10px;border: 1px solid #cbd5e1;font-size: 1rem;transition: border-color 0.25s;}
  .login-box input:focus {outline: none;border-color: #0b74de;box-shadow: 0 0 0 2px rgba(11,116,222,0.15);}
  .login-box button {width: 100%;margin-top: 24px;padding: 14px;border-radius: 10px;border: none;
    background: linear-gradient(90deg, #0b74de, #08a08a);color: #fff;font-size: 1.1rem;font-weight: 600;cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;}
  .login-box button:hover {transform: translateY(-2px);box-shadow: 0 6px 16px rgba(0,0,0,0.2);}
    footer {background: #111827;color: #d1d5db;padding: 14px;text-align: center;font-size: 0.85rem;}
    .btn.ghost {background: transparent;border: 1px solid #fff;color: #fff;padding: 6px 12px;border-radius: 6px;margin-left: 8px;
      cursor: pointer;transition: .3s;}
    .btn.ghost:hover { background: rgba(255,255,255,0.1); }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }}

      /* ===== Rodap√© da Tela de Login ===== */
#loginContainer {min-height: 100vh;width: 100%;display: flex;flex-direction: column;justify-content: center;align-items: center;position: relative;
  padding: 40px 5px;}

/* Mant√©m emoji e caixa pr√≥ximos, mas n√£o colados ao rodap√© */
#loginSection {margin-top: 20px;}

/* ===== Rodap√© fixo ao final da se√ß√£o ===== */
.login-footer {margin-top: auto;text-align: center;font-size: 0.1rem;color: #ffffff;padding: 16px 20px;width: 100%;}
.login-footer .footer-content {background: rgba(255,255,255,0.15);padding: 6px 10px;border-radius: 12px;display: inline-block;backdrop-filter: blur(1px);
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);}
.login-footer .footer-link {display: block;margin-top: 4px;color: #ffffff;text-decoration: none;font-weight: 100;transition: opacity 0.25s;}
.login-footer .footer-link:hover {opacity: 0.8;text-decoration: underline;}
.login-footer .footer-link:hover {opacity: 0.8;text-decoration: underline;}

  </style>
</head>
<body>
  <!-- ===== TELA DE LOGIN ===== -->
<section id="loginContainer">
  <div class="login-icon">üì¶</div>
  <div id="loginSection" class="login-box">
    <h2>Smart_Stock</h2>
    <input type="text" id="username" placeholder="Usu√°rio" />
    <input type="password" id="password" placeholder="Senha" />
    <button id="doLogin">Entrar</button>
    <div>¬© 2024¬© Arezandra.Tech</div></div>
  </div>

  
</section>

  <!-- Tela de Cards -->
  <div id="dashboard" style="display:none; flex:1; flex-direction:column">
    <header>
      <div class="logo"><span>ST</span> Gest√£o de Stock</div>
      <div>
        <strong id="userLabel">Admin</strong>
        <button id="themeToggle" class="btn ghost">üåô</button>
        <button id="doLogout" class="btn ghost">Sair</button>
      </div>
    </header>

    <main>
      <div class="cards">
        <div class="card" onclick="location.href='entradas.html'">
          <h3>üì• Entradas</h3>
          <p class="muted">Registar compras e adicionar stock.</p>
        </div>
        <div class="card" onclick="location.href='saidas.html'">
          <h3>üì§ Sa√≠das</h3>
          <p class="muted">Vendas, descontos, recibos PDF.</p>
        </div>
        <div class="card" onclick="location.href='sobre.html'">
          <h3>‚öôÔ∏è Defini√ß√µes & Estat√≠stica</h3>
          <p class="muted">Gest√£o, relat√≥rios e gr√°ficos.</p>
        </div>
      </div>
    </main>

    <footer>
      ¬© 2025 Sistema de Gest√£o de Stock ‚Äî Arezandra.Tech
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/pouchdb@7.3.1/dist/pouchdb.min.js"></script>
<script>
  // ===== Banco PouchDB =====
  const db = new PouchDB('smart_stock_users');

  // Usu√°rios iniciais (se n√£o existirem)
  const defaultUsers = [
    { _id: 'admin',        username: 'admin',        password: 'admin123', role: 'gestao' },
    { _id: 'cadastro_user',username: 'cadastro_user',password: 'cadastro123', role: 'cadastro' },
    { _id: 'saida_user',   username: 'saida_user',   password: 'saida123', role: 'saida' }
  ];
  defaultUsers.forEach(async u=>{
    try { await db.get(u._id); } catch(e) {
      if(e.status===404) await db.put(u);}});

  // ===== Tema claro/escuro =====
  function toggleTheme(){
    const app = document.body;
    const btn = document.getElementById('themeToggle');
    if(app.getAttribute('data-theme') === 'dark'){
      app.setAttribute('data-theme', 'light');
      btn.textContent = 'üåô';
    } else {
      app.setAttribute('data-theme', 'dark');
      btn.textContent = '‚òÄÔ∏è';}}
  document.getElementById('themeToggle').addEventListener('click', toggleTheme);

  // ===== Login =====
async function doLogin() {
  const user = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value.trim();

  if (!user || !pass) {
    alert('Por favor, preencha usu√°rio e senha.');
    return;
  }

  try {
    const doc = await db.get(user);

    if (doc.password === pass) {
      // üîë Salva sess√£o
      localStorage.setItem('loggedUser', JSON.stringify(doc));

      // ‚úÖ Remove fundo de login e mostra o conte√∫do
      document.body.classList.remove('login-active');
      document.getElementById('loginContainer').style.display = 'none';

      document.getElementById('dashboard').style.display = 'flex';
      document.getElementById('userLabel').textContent = doc.username;

      // üîÑ Limpa campos do formul√°rio para a pr√≥xima vez
      document.getElementById('username').value = "";
      document.getElementById('password').value = "";

      // üîÄ Redirecionamento baseado na role
      switch (doc.role) {
        case 'cadastro':
          location.href = 'entradas.html';
          break;
        case 'saida':
          location.href = 'saidas.html';
          break;
        case 'gestao':
          // Permanece no dashboard
          break;
      }
    } else {
      alert('Senha incorreta!');
    }
  } catch (err) {
    alert('Usu√°rio n√£o encontrado!');}}

  

// ===== Logout =====
function doLogout() {
  document.body.classList.add('login-active');
  localStorage.removeItem('loggedUser');
  document.getElementById('loginContainer').style.display = 'flex';
  document.getElementById('dashboard').style.display = 'none';
  document.getElementById('username').value = "";
  document.getElementById('password').value = "";
}

function applySession(userData){
  document.getElementById('loginContainer').style.display = 'none';
  document.getElementById('dashboard').style.display = 'flex';
  document.getElementById('userLabel').textContent = userData.username;
}

window.addEventListener('load', () => {
  const userData = JSON.parse(localStorage.getItem('loggedUser') || 'null');

  if (location.hash === "#dashboard" && userData?.role === "gestao") {
    applySession(userData);
  } else if (userData?.role === "gestao") {
    // Sess√£o existente sem hash
    applySession(userData);
  } else {
    // Sem sess√£o: for√ßa login
    document.body.classList.add('login-active');
    document.getElementById('loginContainer').style.display = 'flex';
    document.getElementById('dashboard').style.display = 'none';
  }
});

document.getElementById('doLogin').addEventListener('click', doLogin);
document.getElementById('doLogout').addEventListener('click', doLogout);

// Service Worker (opcional)
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/service-worker.js').catch(console.error);
}

</script>
</body>
</html>